[2023-08-02, 17:18:12 UTC] {credentials.py:1180} INFO - Found credentials in environment variables.
[2023-08-02, 17:18:19 UTC] {base.py:71} INFO - Using connection ID 'awsmssql_creosql_creo_conn' for task execution.
[2023-08-02, 17:18:20 UTC] {base.py:71} INFO - Using connection ID 'awsmssql_creosql_creo_conn' for task execution.
[2023-08-02, 17:18:20 UTC] {base.py:71} INFO - Using connection ID 'awsmssql_creosql_creo_conn' for task execution.
[2023-08-02, 17:18:20 UTC] {Staging_CREO.py:586} INFO - BCP connection: <pymssql._pymssql.Connection object at 0x403d5b7c40>
[2023-08-02, 17:18:20 UTC] {Staging_CREO.py:587} INFO - BCP server: rds-ue2-prod-data-read-replica-creo01.cmctpgdigwuk.us-east-2.rds.amazonaws.com
[2023-08-02, 17:18:20 UTC] {Staging_CREO.py:588} INFO - BCP query: 
		SELECT * FROM dbo.CAMPAIGN 
		WHERE CAST(DATE_ENTERED AS DATE) = '2023-07-01 00:00:00';
[2023-08-02, 17:18:20 UTC] {taskinstance.py:1851} ERROR - Task failed with exception
Traceback (most recent call last):
  File "src/pymssql/_pymssql.pyx", line 459, in pymssql._pymssql.Cursor.execute
  File "src/pymssql/_mssql.pyx", line 1087, in pymssql._mssql.MSSQLConnection.execute_query
  File "src/pymssql/_mssql.pyx", line 1118, in pymssql._mssql.MSSQLConnection.execute_query
  File "src/pymssql/_mssql.pyx", line 1251, in pymssql._mssql.MSSQLConnection.format_and_run_query
  File "src/pymssql/_mssql.pyx", line 1789, in pymssql._mssql.check_cancel_and_raise
  File "src/pymssql/_mssql.pyx", line 1835, in pymssql._mssql.raise_MSSQLDatabaseException
pymssql._mssql.MSSQLDatabaseException: (102, b"Incorrect syntax near '/'.DB-Lib error message 20018, severity 15:\nGeneral SQL Server error: Check messages from the SQL Server\n")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/airflow/decorators/base.py", line 188, in execute
    return_value = super().execute(context)
  File "/usr/local/lib/python3.9/site-packages/airflow/operators/python.py", line 175, in execute
    return_value = self.execute_callable()
  File "/usr/local/lib/python3.9/site-packages/airflow/operators/python.py", line 193, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/usr/local/airflow/dags/Staging_CREO.py", line 607, in run_bcp
    cursor.execute(" ".join(bcp_cmd))
  File "src/pymssql/_pymssql.pyx", line 476, in pymssql._pymssql.Cursor.execute
pymssql._pymssql.ProgrammingError: (102, b"Incorrect syntax near '/'.DB-Lib error message 20018, severity 15:\nGeneral SQL Server error: Check messages from the SQL Server\n")
[2023-08-02, 17:18:20 UTC] {taskinstance.py:1401} INFO - Marking task as FAILED. dag_id=Staging_CREO, task_id=CREO_CAMPAIGN_HIST_Task.run_bcp, execution_date=20230802T171716, start_date=20230802T171812, end_date=20230802T171820
[2023-08-02, 17:18:20 UTC] {logging_mixin.py:120} WARNING - /usr/local/lib/python3.9/site-packages/airflow/utils/context.py:204 AirflowContextDeprecationWarning: Accessing 'execution_date' from the template is deprecated and will be removed in a future version. Please use 'data_interval_start' or 'logical_date' instead.
[2023-08-02, 17:18:20 UTC] {base.py:71} INFO - Using connection ID 'ms_teams_callback_conn' for task execution.
[2023-08-02, 17:18:21 UTC] {base.py:71} INFO - Using connection ID 'ms_teams_callback_conn' for task execution.
[2023-08-02, 17:18:21 UTC] {logging_mixin.py:120} INFO - {}
[2023-08-02, 17:18:21 UTC] {logging_mixin.py:120} INFO - Proxy is : 
[2023-08-02, 17:18:21 UTC] {base.py:71} INFO - Using connection ID 'ms_teams_callback_conn' for task execution.
[2023-08-02, 17:18:21 UTC] {http.py:148} INFO - Sending 'POST' to url: https://NOHOOK_FOR_DEV
[2023-08-02, 17:18:21 UTC] {http.py:206} WARNING - HTTPSConnectionPool(host='nohook_for_dev', port=443): Max retries exceeded with url: / (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x403dfbff10>: Failed to establish a new connection: [Errno -2] Name or service not known')) Tenacity will retry to execute the operation
[2023-08-02, 17:18:21 UTC] {taskinstance.py:1619} ERROR - Error when executing on_failure callback
Traceback (most recent call last):
  File "src/pymssql/_pymssql.pyx", line 459, in pymssql._pymssql.Cursor.execute
  File "src/pymssql/_mssql.pyx", line 1087, in pymssql._mssql.MSSQLConnection.execute_query
  File "src/pymssql/_mssql.pyx", line 1118, in pymssql._mssql.MSSQLConnection.execute_query
  File "src/pymssql/_mssql.pyx", line 1251, in pymssql._mssql.MSSQLConnection.format_and_run_query
  File "src/pymssql/_mssql.pyx", line 1789, in pymssql._mssql.check_cancel_and_raise
  File "src/pymssql/_mssql.pyx", line 1835, in pymssql._mssql.raise_MSSQLDatabaseException
pymssql._mssql.MSSQLDatabaseException: (102, b"Incorrect syntax near '/'.DB-Lib error message 20018, severity 15:\nGeneral SQL Server error: Check messages from the SQL Server\n")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/airflow/models/taskinstance.py", line 1457, in _run_raw_task
    self._execute_task_with_callbacks(context, test_mode)
  File "/usr/local/lib/python3.9/site-packages/airflow/models/taskinstance.py", line 1603, in _execute_task_with_callbacks
    result = self._execute_task(context, task_orig)
  File "/usr/local/lib/python3.9/site-packages/airflow/models/taskinstance.py", line 1659, in _execute_task
    result = execute_callable(context=context)
  File "/usr/local/lib/python3.9/site-packages/airflow/decorators/base.py", line 188, in execute
    return_value = super().execute(context)
  File "/usr/local/lib/python3.9/site-packages/airflow/operators/python.py", line 175, in execute
    return_value = self.execute_callable()
  File "/usr/local/lib/python3.9/site-packages/airflow/operators/python.py", line 193, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
  File "/usr/local/airflow/dags/Staging_CREO.py", line 607, in run_bcp
    cursor.execute(" ".join(bcp_cmd))
  File "src/pymssql/_pymssql.pyx", line 476, in pymssql._pymssql.Cursor.execute
pymssql._pymssql.ProgrammingError: (102, b"Incorrect syntax near '/'.DB-Lib error message 20018, severity 15:\nGeneral SQL Server error: Check messages from the SQL Server\n")

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/urllib3/connection.py", line 174, in _new_conn
    conn = connection.create_connection(
  File "/usr/local/lib/python3.9/site-packages/urllib3/util/connection.py", line 72, in create_connection
    for res in socket.getaddrinfo(host, port, family, socket.SOCK_STREAM):
  File "/usr/local/lib/python3.9/socket.py", line 954, in getaddrinfo
    for res in _socket.getaddrinfo(host, port, family, type, proto, flags):
socket.gaierror: [Errno -2] Name or service not known

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/urllib3/connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
  File "/usr/local/lib/python3.9/site-packages/urllib3/connectionpool.py", line 386, in _make_request
    self._validate_conn(conn)
  File "/usr/local/lib/python3.9/site-packages/urllib3/connectionpool.py", line 1042, in _validate_conn
    conn.connect()
  File "/usr/local/lib/python3.9/site-packages/urllib3/connection.py", line 358, in connect
    self.sock = conn = self._new_conn()
  File "/usr/local/lib/python3.9/site-packages/urllib3/connection.py", line 186, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPSConnection object at 0x403dfbff10>: Failed to establish a new connection: [Errno -2] Name or service not known

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/requests/adapters.py", line 489, in send
    resp = conn.urlopen(
  File "/usr/local/lib/python3.9/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    retries = retries.increment(
  File "/usr/local/lib/python3.9/site-packages/urllib3/util/retry.py", line 592, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='nohook_for_dev', port=443): Max retries exceeded with url: / (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x403dfbff10>: Failed to establish a new connection: [Errno -2] Name or service not known'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/local/lib/python3.9/site-packages/airflow/models/taskinstance.py", line 1617, in _run_finished_callback
    callback(context)
  File "/usr/local/airflow/include/functions/ms_teams_callback_functions.py", line 91, in failure_callback
    return teams_notification.execute(context)
  File "/usr/local/airflow/include/operators/ms_teams_webhook_operator.py", line 89, in execute
    self.hook.execute()
  File "/usr/local/airflow/include/hooks/ms_teams_webhook_hook.py", line 129, in execute
    self.run(endpoint=self.webhook_token,
  File "/usr/local/lib/python3.9/site-packages/airflow/providers/http/hooks/http.py", line 149, in run
    return self.run_and_check(session, prepped_request, extra_options)
  File "/usr/local/lib/python3.9/site-packages/airflow/providers/http/hooks/http.py", line 207, in run_and_check
    raise ex
  File "/usr/local/lib/python3.9/site-packages/airflow/providers/http/hooks/http.py", line 199, in run_and_check
    response = session.send(prepped_request, **send_kwargs)
  File "/usr/local/lib/python3.9/site-packages/requests/sessions.py", line 701, in send
    r = adapter.send(request, **kwargs)
  File "/usr/local/lib/python3.9/site-packages/requests/adapters.py", line 565, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPSConnectionPool(host='nohook_for_dev', port=443): Max retries exceeded with url: / (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x403dfbff10>: Failed to establish a new connection: [Errno -2] Name or service not known'))
[2023-08-02, 17:18:21 UTC] {manager.py:67} WARNING - Unable to find an extractor. task_type=_PythonDecoratedOperator airflow_dag_id=Staging_CREO task_id=CREO_CAMPAIGN_HIST_Task.run_bcp airflow_run_id=manual__2023-08-02T17:17:16.958905+00:00 
[2023-08-02, 17:18:21 UTC] {console.py:22} INFO - {"eventTime": "2023-08-02T17:18:20.710164Z", "eventType": "FAIL", "inputs": [], "job": {"facets": {}, "name": "Staging_CREO.CREO_CAMPAIGN_HIST_Task.run_bcp", "namespace": "default"}, "outputs": [], "producer": "https://github.com/OpenLineage/OpenLineage/tree/0.15.1/integration/airflow", "run": {"facets": {"unknownSourceAttribute": {"_producer": "https://github.com/OpenLineage/OpenLineage/tree/0.15.1/integration/airflow", "_schemaURL": "https://raw.githubusercontent.com/OpenLineage/OpenLineage/main/spec/OpenLineage.json#/definitions/BaseFacet", "unknownItems": [{"name": "_PythonDecoratedOperator", "properties": {"_BaseOperator__from_mapped": false, "_BaseOperator__init_kwargs": {"execution_timeout": "<<non-serializable: timedelta>>", "kwargs_to_upstream": {"op_args": [], "op_kwargs": {}, "python_callable": "<<non-serializable: function>>"}, "multiple_outputs": false, "on_failure_callback": "<<non-serializable: function>>", "op_args": [{"aod": "<<non-serializable: datetime>>", "columns": " $1,  $2,  $3,  $4,  $5,  $6,  $7,  $8,  $9,  $10,  $11,  $12,  $13,  $14,  $15,  $16,  $17,  $18,  $19,  $20", "csv_file_name": "CAMPAIGN_20230701.csv", "local_output_dir": "include/bcp/Staging_CREO/2023/08/02/CAMPAIGN", "mssql_query": "\n\t\tSELECT * FROM dbo.CAMPAIGN \n\t\tWHERE CAST(DATE_ENTERED AS DATE) = '2023-07-01 00:00:00';\n\t", "s3_file_path": "CREO/2023/07/CAMPAIGN/", "sf_table_name": "CREO_CAMPAIGN_HIST", "table_list": {"key_column": "CAMPAIGN_KEY", "table_filtered_by": "DATE_ENTERED"}, "trunc_table_name": "CAMPAIGN", "zip_file_name": "CAMPAIGN_20230701.csv.gz"}], "op_kwargs": {}, "python_callable": "<<non-serializable: function>>", "retries": 0, "retry_delay": "<<non-serializable: timedelta>>", "task_id": "CREO_CAMPAIGN_HIST_Task.run_bcp"}, "_BaseOperator__instantiated": true, "_dag": "<<non-serializable: DAG>>", "_log": "<<non-serializable: Logger>>", "depends_on_past": false, "do_xcom_push": true, "doc_md": "\n\t\tExecutes the BCP utility command to export data from the MSSQL database.\n\n\t\tFetches the SQL query from the XCom variable \"mssql_query\" and writes the exported data\n\t\tto a CSV file.\n\n\t\tParameters:\n\t\t\tcsv_out_path (str): The file path to save the exported CSV file.\n\t\t\tquery (str): The SQL query to execute for data export.\n\t\t\tdelimiter (str, optional): The delimiter to use in the CSV file. Defaults to '|'.\n\t\t\tlinebreak (str, optional): The linebreak character in the CSV file. Defaults to os.linesep.\n\n\t\tRaises:\n\t\t\tException: If the CSV file is not found after the export.\n\t\t", "downstream_task_ids": [], "email_on_failure": true, "email_on_retry": true, "execution_timeout": "<<non-serializable: timedelta>>", "executor_config": {}, "ignore_first_depends_on_past": true, "inlets": [], "multiple_outputs": false, "on_failure_callback": "<<non-serializable: function>>", "op_args": [{"aod": "<<non-serializable: datetime>>", "columns": " $1,  $2,  $3,  $4,  $5,  $6,  $7,  $8,  $9,  $10,  $11,  $12,  $13,  $14,  $15,  $16,  $17,  $18,  $19,  $20", "csv_file_name": "CAMPAIGN_20230701.csv", "local_output_dir": "include/bcp/Staging_CREO/2023/08/02/CAMPAIGN", "mssql_query": "\n\t\tSELECT * FROM dbo.CAMPAIGN \n\t\tWHERE CAST(DATE_ENTERED AS DATE) = '2023-07-01 00:00:00';\n\t", "s3_file_path": "CREO/2023/07/CAMPAIGN/", "sf_table_name": "CREO_CAMPAIGN_HIST", "table_list": {"key_column": "CAMPAIGN_KEY", "table_filtered_by": "DATE_ENTERED"}, "trunc_table_name": "CAMPAIGN", "zip_file_name": "CAMPAIGN_20230701.csv.gz"}], "op_kwargs": {}, "outlets": [], "owner": "airflow", "params": "<<non-serializable: ParamsDict>>", "pool": "default_pool", "pool_slots": 1, "priority_weight": 1, "python_callable": "<<non-serializable: function>>", "queue": "default", "retries": 0, "retry_delay": "<<non-serializable: timedelta>>", "retry_exponential_backoff": false, "show_return_value_in_logs": true, "start_date": "<<non-serializable: DateTime>>", "task_group": "<<non-serializable: TaskGroup>>", "task_id": "CREO_CAMPAIGN_HIST_Task.run_bcp", "trigger_rule": "all_success", "upstream_task_ids": [], "wait_for_downstream": false, "weight_rule": "downstream"}, "type": "operator"}]}}, "runId": "948070dd-400d-4974-a0b3-3206c95a481a"}}
[2023-08-02, 17:18:21 UTC] {standard_task_runner.py:100} ERROR - Failed to execute job 710 for task CREO_CAMPAIGN_HIST_Task.run_bcp ((102, b"Incorrect syntax near '/'.DB-Lib error message 20018, severity 15:\nGeneral SQL Server error: Check messages from the SQL Server\n"); 39739)
[2023-08-02, 17:18:21 UTC] {local_task_job.py:164} INFO - Task exited with return code 1
[2023-08-02, 17:18:21 UTC] {local_task_job.py:273} INFO - 0 downstream tasks scheduled from follow-on schedule check
